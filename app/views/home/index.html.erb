
<div class='title_page'>
  <span> <%= t('home.title') %> </span>
</div>

<div class='subtitle'> <%= t('home.search.title') %> </div>
<div class='section'>
  <%= form_tag(filter_name_home_index_path, :method=>'get') do |f| %>
    <div class='label1 top req'> <%= t("home.search.name") %>: </div>
    <%= text_field_tag 'name', params[:name], :size => 80 %>
    <div class='label1 top req'> <%= t('home.search.cpf') %>: </div>
    <%= text_field_tag 'cpf', params[:cpf], :size => 20 %>
    <div class='label1 top req'> <%= t('home.search.cna') %>: </div>
    <%= text_field_tag 'cna', params[:cna], :size => 20 %>
    <br>
    <%= submit_tag t('menu.search') %> ou <%= link_to t('menu.clean'), root_path %>
  <% end %>
</div>

<div class='list1'>
  <% unless @taxpayers.nil? %>
    <% @taxpayers.each do |taxpayer| %>
      <li>
        <div class='strip' id='none'> <%= taxpayer.origin_code %> </div>

        <div class='indent'>
          <%= link_to(taxpayer.name, home_path(taxpayer)) %>
            &bull;
          <tt>
            <%= taxpayer.cpf %>
            &bull;
            <%= taxpayer.client.name if taxpayer.client %>
            &bull;
            <%= taxpayer.address %>
            &bull;
            <%= taxpayer.city.name if taxpayer.city %>
            &bull;
            <%= taxpayer.city.state if taxpayer.city %>
          </tt>
          <dt>
          </dt>
        </div>
      </li>
    <% end %>

    <% unless @taxpayers.empty? %>
      <div class="apple_pagination">
        <%= will_paginate @taxpayers, :container => false %>
      </div>
      <br>
    <% end %>

  <% end %>
</div>

<% if @taxpayer %>
  <div class="row marketing">
    <div class="col-sm-6 col-md-4">
      <div class="panel panel-primary">
        <div class='title_tools'>
          <% if @taxpayer.city.present? and @taxpayer.city.fl_charge %>
            <a class="btn btn-large btn-warning" <%= link_to(t('home.deal'), deal_url(cod: @taxpayer.id)) %> </a>
          <% else %>
            <a class="btn btn-large btn-danger"> <%= "Não liberado para cobrança" %> </a>
          <% end %>
        </div>
        <div class='title_page'> <%= t('home.taxpayer') %> </div>
        <% unless @taxpayer.nil? %>
          <div class='section'>
            <div class='label1 top req'> <%=t("taxpayer.origin_code") %>: </div>  <%= @taxpayer.origin_code %>
            <div class='label1 top req'> <%=t("client.name") %>: </div>   <%= @taxpayer.client.name %>
            <div class='label1 top req'> <%=t("taxpayer.name") %>: </div> <%= @taxpayer.name %>
            <div class='label1 top req'> <%=t("phone") %>: </div>         <%= @taxpayer.phone %>
            <div class='label1 top req'> <%=t("cnpj_cpf") %>: </div>      <%= @taxpayer.cpf.present? ? @taxpayer.cpf : @taxpayer.cnpj %>
            <div class='label1 top req'> <%=t("address") %>: </div>        <%= @taxpayer.address %>
            <div class='label1 top req'> <%=t("complement") %>: </div>     <%= @taxpayer.complement %>
            <div class='label1 top req'> <%=t("neighborhood") %>: </div>   <%= @taxpayer.neighborhood %>
            <div class='label1 top req'> <%=t("zipcode") %>: </div>        <%= @taxpayer.zipcode %>
            <div class='label1 top req'> <%=t("taxpayer.city") %>: </div>  <%= @taxpayer.city.name if @taxpayer.city %>
            <div class='label1 top req'> <%=t("state") %>: </div>          <%= @taxpayer.city.state if @taxpayer.city %>
          </div>
        <% end %> 
      </div>
    </div>

    <div class="col-sm-6 col-md-8">

      <div class="panel panel-primary">
        <div class='title_page'> <%= t('home.cna.title') %> </div>
        <table class="table">
          <thead>
            <tr>
              <th>Ano</th>
              <th>Num Doc</th>
              <th>Vencimento</th>
              <th>Valor CNA</th>
              <th>Meses</th>
              <th>Multa</th>
              <th>Juros</th>
              <th>Valor GUIA</th>
              <th><%= t('stage') %></th>
              <th><%= t('status') %></th>
            </tr>
          </thead>
          <tbody>
            <% unless @cnas.nil? %>
              <% @cnas.each do |cna| %>
                <tr>
                  <td><%= cna.year %> </td>
                  <td><%= cna.nr_document %> </td>
                  <td><%= cna.due_at.to_date.to_s_br %> </td>
                  <td><%= cna.amount.real %> </td>
                  <td><%= calc_meses_atraso(cna) %> </td>
                  <td><%= calc_multa(cna).real %> </td>
                  <td><%= calc_juros(cna).real %> </td>
                  <td><%= calc_cna(cna).real %> </td>
                  <td><%= t(cna.stage) %> </td>
                  <td><%= t(cna.status) %> </td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
          <tfoot>
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td><%= session[:value_cna].real %></td>
              <td></td>
              <td> <%= session[:total_multa].real %> </td>
              <td> <%= session[:total_juros].real %> </td>
              <td> <%= session[:total_cna].real %></td>
              <td></td>
              <td></td>
            </tr>
          </tfoot>  
        </table>

        <br>
        <div class='title_page'> <%= t('home.history.title') %> </div>
        <table class="table">
          <thead>
            <tr>
              <th>Data</th>
              <th>Histórico</th>
            </tr>
          </thead>
          <tbody>
            <% unless @histories.nil? %>
              <% @histories.each do |history| %>
                <tr>
                  <td><%= history.history_date %> </td>
                  <td><%= history.description %> </td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
        </table>

      </div>


    </div>
  </div>
<% end %>
